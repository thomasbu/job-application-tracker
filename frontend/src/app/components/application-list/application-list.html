<div class="container">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div>
          <h1 class="title">ðŸ“‹ Job Applications Tracker</h1>
          <p class="subtitle">Manage your job applications efficiently</p>
        </div>
        <button class="btn btn-primary" (click)="openCreateDialog()">
          <svg class="icon" viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          New Application
        </button>
      </div>

      <!-- Stats Cards -->
      <div class="stats-cards">
        <div class="stat-card stat-total">
          <div class="stat-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <path
                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
              ></path>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().total }}</div>
            <div class="stat-label">Total</div>
          </div>
        </div>

        <div class="stat-card stat-sent">
          <div class="stat-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().sent }}</div>
            <div class="stat-label">Sent</div>
          </div>
        </div>

        <div class="stat-card stat-interview">
          <div class="stat-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().interview }}</div>
            <div class="stat-label">Interview</div>
          </div>
        </div>

        <div class="stat-card stat-rejected">
          <div class="stat-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().rejected }}</div>
            <div class="stat-label">Rejected</div>
          </div>
        </div>

        <div class="stat-card stat-accepted">
          <div class="stat-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().accepted }}</div>
            <div class="stat-label">Accepted</div>
          </div>
        </div>
      </div>

      <!-- Filter & Search Bar -->
      <div class="filter-bar">
        <div class="filter-group">
          <label class="label" for="statusFilter">Filter by status</label>
          <select
            id="statusFilter"
            class="input"
            [value]="statusFilter()"
            (change)="onFilterChange($event)"
          >
            <option value="ALL">All Applications</option>
            @for (status of statuses; track status) {
            <option [value]="status">{{ status | statusLabel }}</option>
            }
          </select>
        </div>

        <div class="search-group">
          <label class="label" for="searchInput">Search</label>
          <div class="search-input-wrapper">
            <svg class="search-icon" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              id="searchInput"
              type="text"
              class="input search-input"
              placeholder="Search applications..."
              [value]="searchTerm()"
              (input)="onSearchInput($event)"
              aria-label="Search applications by company or position"
            />
            @if (searchTerm()) {
            <button
              class="btn-clear"
              (click)="clearSearch()"
              aria-label="Clear search"
            >
              <svg class="icon" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            }
          </div>
        </div>
      </div>

      <!-- Search active badge -->
      @if (searchTerm()) {
      <div class="search-active-bar">
        <span class="search-active-badge">
          Filtering: {{ filteredApplications().length }} result{{ filteredApplications().length !== 1 ? 's' : '' }}
        </span>
      </div>
      }
    </header>

    <!-- Table -->
    <div class="card table-card">
      @if (filteredApplications().length === 0) {
      <div class="empty-state">
        <svg class="empty-icon" viewBox="0 0 24 24">
          <path
            d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-6l-2-2H5a2 2 0 0 0-2 2z"
          ></path>
        </svg>
        @if (searchTerm()) {
        <h3>No matching applications</h3>
        <p>Try adjusting your search term</p>
        <button class="btn btn-secondary" (click)="clearSearch()">
          Clear search
        </button>
        } @else {
        <h3>No applications found</h3>
        <p>Start tracking your job applications</p>
        <button class="btn btn-primary" (click)="openCreateDialog()">
          Add your first application
        </button>
        }
      </div>
      } @else {
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th class="sortable" (click)="onSort('company')" aria-label="Sort by company">
                <span class="th-content">
                  Company
                  @if (sortColumn() === 'company') {
                  <svg class="sort-icon" viewBox="0 0 24 24">
                    @if (sortDirection() === 'asc') {
                    <path d="M12 5l0 14M5 12l7-7 7 7"></path>
                    } @else {
                    <path d="M12 19l0-14M5 12l7 7 7-7"></path>
                    }
                  </svg>
                  }
                </span>
              </th>
              <th class="sortable" (click)="onSort('position')" aria-label="Sort by position">
                <span class="th-content">
                  Position
                  @if (sortColumn() === 'position') {
                  <svg class="sort-icon" viewBox="0 0 24 24">
                    @if (sortDirection() === 'asc') {
                    <path d="M12 5l0 14M5 12l7-7 7 7"></path>
                    } @else {
                    <path d="M12 19l0-14M5 12l7 7 7-7"></path>
                    }
                  </svg>
                  }
                </span>
              </th>
              <th class="sortable" (click)="onSort('applicationDate')" aria-label="Sort by applied date">
                <span class="th-content">
                  Applied Date
                  @if (sortColumn() === 'applicationDate') {
                  <svg class="sort-icon" viewBox="0 0 24 24">
                    @if (sortDirection() === 'asc') {
                    <path d="M12 5l0 14M5 12l7-7 7 7"></path>
                    } @else {
                    <path d="M12 19l0-14M5 12l7 7 7-7"></path>
                    }
                  </svg>
                  }
                </span>
              </th>
              <th class="sortable" (click)="onSort('currentStatus')" aria-label="Sort by status">
                <span class="th-content">
                  Status
                  @if (sortColumn() === 'currentStatus') {
                  <svg class="sort-icon" viewBox="0 0 24 24">
                    @if (sortDirection() === 'asc') {
                    <path d="M12 5l0 14M5 12l7-7 7 7"></path>
                    } @else {
                    <path d="M12 19l0-14M5 12l7 7 7-7"></path>
                    }
                  </svg>
                  }
                </span>
              </th>
              <th>Documents</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (app of paginatedApplications(); track app.id) {
            <tr>
              <td>
                <div class="company-cell">
                  <strong>{{ app.company }}</strong>
                </div>
              </td>
              <td>{{ app.position }}</td>
              <td>{{ app.applicationDate | date : 'MMM d, y' }}</td>
              <td>
                <span class="badge badge-{{ app.currentStatus | statusColor }}">
                  {{ app.currentStatus | statusLabel }}
                </span>
              </td>
              <td>
                <div class="document-cell">
                  @if (app.documentCount && app.documentCount > 0) {
                  <span class="badge badge-primary">
                    {{ app.documentCount }} file{{ app.documentCount > 1 ? 's' : '' }}
                  </span>
                  } @else {
                  <svg class="icon icon-muted" viewBox="0 0 24 24">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  }
                </div>
              </td>
              <td>
                <div class="actions">
                  <button class="btn btn-icon btn-ghost" (click)="openEditDialog(app)" title="Edit">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>

                  <button
                    class="btn btn-icon btn-ghost"
                    (click)="deleteApplication(app.id)"
                    title="Delete application"
                  >
                    <svg class="icon" viewBox="0 0 24 24" stroke="#ef4444">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path
                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                      ></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button
          class="btn btn-secondary btn-sm"
          (click)="previousPage()"
          [disabled]="currentPage() === 1"
          aria-label="Previous page"
        >
          <svg class="icon" viewBox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Previous
        </button>

        <div class="pagination-info">
          <span>Page {{ currentPage() }} of {{ totalPages() }}</span>
        </div>

        <div class="pagination-size">
          <label for="pageSize" class="sr-only">Items per page</label>
          <select
            id="pageSize"
            class="input input-sm"
            [value]="itemsPerPage()"
            (change)="onPageSizeChange($event)"
            aria-label="Items per page"
          >
            <option [value]="10">10 / page</option>
            <option [value]="25">25 / page</option>
            <option [value]="50">50 / page</option>
          </select>
        </div>

        <button
          class="btn btn-secondary btn-sm"
          (click)="nextPage()"
          [disabled]="currentPage() >= totalPages()"
          aria-label="Next page"
        >
          Next
          <svg class="icon" viewBox="0 0 24 24">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      }
    </div>
  </div>

  @if (showDialog()) {
  <app-application-dialog [application]="editingApplication()" (close)="closeDialog($event)">
  </app-application-dialog>
  }

  <!-- Confirm Delete Dialog -->
  @if (showConfirmDelete()) {
  <app-confirm-dialog
    title="Delete Application"
    message="Are you sure you want to delete this application? All associated documents will be permanently deleted."
    confirmText="Delete"
    cancelText="Cancel"
    [isDanger]="true"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()"
  >
  </app-confirm-dialog>
  }
</div>
